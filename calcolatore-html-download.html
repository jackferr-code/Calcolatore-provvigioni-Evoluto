<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcolatore Comparativo - Agente vs Imprenditore</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone per JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ReferenceLine } = Recharts;

        const Calculator = () => {
            return React.createElement('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: "32",
                height: "32",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeLinejoin: "round"
            }, [
                React.createElement('rect', { key: 1, x: "4", y: "2", width: "16", height: "20", rx: "2" }),
                React.createElement('line', { key: 2, x1: "8", y1: "6", x2: "16", y2: "6" }),
                React.createElement('line', { key: 3, x1: "16", y1: "14", x2: "16", y2: "18" }),
                React.createElement('path', { key: 4, d: "M16 10h.01" }),
                React.createElement('path', { key: 5, d: "M12 10h.01" }),
                React.createElement('path', { key: 6, d: "M8 10h.01" }),
                React.createElement('path', { key: 7, d: "M12 14h.01" }),
                React.createElement('path', { key: 8, d: "M8 14h.01" }),
                React.createElement('path', { key: 9, d: "M12 18h.01" }),
                React.createElement('path', { key: 10, d: "M8 18h.01" })
            ]);
        };

        const CalcolatoreComparativo = () => {
            const [totaliMensili, setTotaliMensili] = useState({
                pagine: 0,
                prioritarie: 0,
                raccomandate: 0
            });

            const [costiImprenditore, setCostiImprenditore] = useState({
                costoCarta: 0.0073,
                costoStampaFacciata: 0.006,
                costoBusta: 0.05,
                costoStampaBusta: 0.07,
                costoCartaAvvisoRicevimento: 0.0672,
                costoStampaAvvisoRicevimento: 0.018,
                costoOrarioDipendente: 15,
                tempoImbustamentoSecondi: 30,
                feePagina: 0.02,
                feeBusta: 0.10,
                fogliExtraPerBusta: 1.5,
                fronteRetro: true
            });

            const [presetProvvigioni, setPresetProvvigioni] = useState({
                preset203: { pagine: 0.000, prioritarie: 0.050, raccomandate: 0.250 },
                preset204: { pagine: 0.025, prioritarie: 0.050, raccomandate: 0.250 },
                preset205: { pagine: 0.050, prioritarie: 0.050, raccomandate: 0.250 }
            });

            const formatNumber = (num) => {
                return new Intl.NumberFormat('it-IT', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(num);
            };

            const [listiniAgente, setListiniAgente] = useState([
                { codice: '101', busta: 0.20, pagina: 0.08, clienti: { pagine: 0.000, prioritarie: 0.000, raccomandate: 0.000 }, distributori: { pagine: 0.000, prioritarie: 0.050, raccomandate: 0.250 } },
                { codice: '111', busta: 0.20, pagina: 0.08, clienti: { pagine: 0.000, prioritarie: 0.050, raccomandate: 0.250 }, distributori: { pagine: 0.000, prioritarie: 0.050, raccomandate: 0.250 } },
                { codice: '102', busta: 0.25, pagina: 0.10, clienti: { pagine: 0.000, prioritarie: 0.050, raccomandate: 0.250 }, distributori: { pagine: 0.000, prioritarie: 0.050, raccomandate: 0.500 } },
                { codice: '112', busta: 0.25, pagina: 0.10, clienti: { pagine: 0.000, prioritarie: 0.050, raccomandate: 0.500 }, distributori: { pagine: 0.000, prioritarie: 0.050, raccomandate: 0.250 } },
                { codice: '103', busta: 0.25, pagina: 0.15, clienti: { pagine: 0.025, prioritarie: 0.050, raccomandate: 0.250 }, distributori: { pagine: 0.015, prioritarie: 0.050, raccomandate: 0.500 } },
                { codice: '113', busta: 0.25, pagina: 0.15, clienti: { pagine: 0.025, prioritarie: 0.050, raccomandate: 0.500 }, distributori: { pagine: 0.010, prioritarie: 0.050, raccomandate: 0.250 } },
                { codice: '123', busta: 0.25, pagina: 0.15, clienti: { pagine: 0.025, prioritarie: 0.050, raccomandate: 1.000 }, distributori: { pagine: 0.005, prioritarie: 0.050, raccomandate: 0.000 } },
                { codice: '104', busta: 0.25, pagina: 0.20, clienti: { pagine: 0.050, prioritarie: 0.050, raccomandate: 0.250 }, distributori: { pagine: 0.025, prioritarie: 0.050, raccomandate: 0.500 } },
                { codice: '114', busta: 0.25, pagina: 0.20, clienti: { pagine: 0.050, prioritarie: 0.050, raccomandate: 0.500 }, distributori: { pagine: 0.020, prioritarie: 0.050, raccomandate: 0.250 } },
                { codice: '124', busta: 0.25, pagina: 0.20, clienti: { pagine: 0.050, prioritarie: 0.050, raccomandate: 1.000 }, distributori: { pagine: 0.015, prioritarie: 0.050, raccomandate: 0.000 } },
                { codice: '105', busta: 0.25, pagina: 0.25, clienti: { pagine: 0.075, prioritarie: 0.050, raccomandate: 0.250 }, distributori: { pagine: 0.040, prioritarie: 0.050, raccomandate: 0.500 } },
                { codice: '115', busta: 0.25, pagina: 0.25, clienti: { pagine: 0.075, prioritarie: 0.050, raccomandate: 0.500 }, distributori: { pagine: 0.035, prioritarie: 0.050, raccomandate: 0.250 } },
                { codice: '125', busta: 0.25, pagina: 0.25, clienti: { pagine: 0.075, prioritarie: 0.050, raccomandate: 1.000 }, distributori: { pagine: 0.030, prioritarie: 0.050, raccomandate: 0.000 } }
            ]);

            const [listiniImprenditore, setListiniImprenditore] = useState([
                { codice: '101', busta: 0.20, pagina: 0.08, clienti: { pagine: 0.000, prioritarie: 0.000, raccomandate: 0.000 }, calcolaProvvigioniClienti: true },
                { codice: '111', busta: 0.20, pagina: 0.08, clienti: { pagine: 0.000, prioritarie: 0.050, raccomandate: 0.250 }, calcolaProvvigioniClienti: true },
                { codice: '102', busta: 0.25, pagina: 0.10, clienti: { pagine: 0.000, prioritarie: 0.050, raccomandate: 0.250 }, calcolaProvvigioniClienti: true },
                { codice: '112', busta: 0.25, pagina: 0.10, clienti: { pagine: 0.000, prioritarie: 0.050, raccomandate: 0.500 }, calcolaProvvigioniClienti: true },
                { codice: '103', busta: 0.25, pagina: 0.15, clienti: { pagine: 0.025, prioritarie: 0.050, raccomandate: 0.250 }, calcolaProvvigioniClienti: true },
                { codice: '113', busta: 0.25, pagina: 0.15, clienti: { pagine: 0.025, prioritarie: 0.050, raccomandate: 0.500 }, calcolaProvvigioniClienti: true },
                { codice: '123', busta: 0.25, pagina: 0.15, clienti: { pagine: 0.025, prioritarie: 0.050, raccomandate: 1.000 }, calcolaProvvigioniClienti: true },
                { codice: '104', busta: 0.25, pagina: 0.20, clienti: { pagine: 0.050, prioritarie: 0.050, raccomandate: 0.250 }, calcolaProvvigioniClienti: true },
                { codice: '114', busta: 0.25, pagina: 0.20, clienti: { pagine: 0.050, prioritarie: 0.050, raccomandate: 0.500 }, calcolaProvvigioniClienti: true },
                { codice: '124', busta: 0.25, pagina: 0.20, clienti: { pagine: 0.050, prioritarie: 0.050, raccomandate: 1.000 }, calcolaProvvigioniClienti: true },
                { codice: '105', busta: 0.25, pagina: 0.25, clienti: { pagine: 0.075, prioritarie: 0.050, raccomandate: 0.250 }, calcolaProvvigioniClienti: true },
                { codice: '115', busta: 0.25, pagina: 0.25, clienti: { pagine: 0.075, prioritarie: 0.050, raccomandate: 0.500 }, calcolaProvvigioniClienti: true },
                { codice: '125', busta: 0.25, pagina: 0.25, clienti: { pagine: 0.075, prioritarie: 0.050, raccomandate: 1.000 }, calcolaProvvigioniClienti: true }
            ]);

            const handleInputChange = (field, value) => {
                setTotaliMensili(prev => ({
                    ...prev,
                    [field]: parseFloat(value) || 0
                }));
            };

            const handleListinoAgenteChange = (index, field, subfield, value) => {
                const newListini = [...listiniAgente];
                if (subfield) {
                    newListini[index][field][subfield] = parseFloat(value) || 0;
                } else {
                    newListini[index][field] = parseFloat(value) || 0;
                }
                setListiniAgente(newListini);
            };

            const handleListinoImprenditoreChange = (index, field, subfield, value) => {
                const newListini = [...listiniImprenditore];
                if (subfield) {
                    newListini[index][field][subfield] = parseFloat(value) || 0;
                } else if (field === 'calcolaProvvigioniClienti') {
                    newListini[index][field] = value;
                } else {
                    newListini[index][field] = parseFloat(value) || 0;
                }
                setListiniImprenditore(newListini);
            };

            const handleCostiChange = (field, value) => {
                if (field === 'fronteRetro') {
                    setCostiImprenditore(prev => ({
                        ...prev,
                        [field]: value
                    }));
                } else {
                    setCostiImprenditore(prev => ({
                        ...prev,
                        [field]: parseFloat(value) || 0
                    }));
                }
            };

            const handlePresetChange = (preset, field, value) => {
                setPresetProvvigioni(prev => ({
                    ...prev,
                    [preset]: {
                        ...prev[preset],
                        [field]: parseFloat(value) || 0
                    }
                }));
            };

            const applicaPresetProvvigioni = (index, preset) => {
                const valoriPreset = presetProvvigioni[preset];
                const newListini = [...listiniImprenditore];
                newListini[index].clienti = {
                    pagine: valoriPreset.pagine,
                    prioritarie: valoriPreset.prioritarie,
                    raccomandate: valoriPreset.raccomandate
                };
                setListiniImprenditore(newListini);
            };

            const calcolaTotaleVenditaAgente = (listino) => {
                const totalePagine = totaliMensili.pagine * listino.pagina;
                const totaleBuste = (totaliMensili.prioritarie + totaliMensili.raccomandate) * listino.busta;
                return totalePagine + totaleBuste;
            };

            const calcolaProvvigioniDistributori = (listino) => {
                return (
                    totaliMensili.pagine * listino.distributori.pagine +
                    totaliMensili.prioritarie * listino.distributori.prioritarie +
                    totaliMensili.raccomandate * listino.distributori.raccomandate
                );
            };

            const calcolaTotaleVenditaImprenditore = (listino) => {
                const totalePagine = totaliMensili.pagine * listino.pagina;
                const totaleBuste = (totaliMensili.prioritarie + totaliMensili.raccomandate) * listino.busta;
                return totalePagine + totaleBuste;
            };

            const calcolaProvvigioniClienti = (listino) => {
                return (
                    totaliMensili.pagine * listino.clienti.pagine +
                    totaliMensili.prioritarie * listino.clienti.prioritarie +
                    totaliMensili.raccomandate * listino.clienti.raccomandate
                );
            };

            const calcolaCostiImprenditore = (listino) => {
                const totaleBuste = totaliMensili.prioritarie + totaliMensili.raccomandate;
                
                const feePagine = totaliMensili.pagine * costiImprenditore.feePagina;
                const feeBuste = totaleBuste * costiImprenditore.feeBusta;
                const totaleFee = feePagine + feeBuste;

                const costoCartaPagine = costiImprenditore.fronteRetro 
                    ? (totaliMensili.pagine / 2) * costiImprenditore.costoCarta
                    : totaliMensili.pagine * costiImprenditore.costoCarta;

                const costoStampaPagine = totaliMensili.pagine * costiImprenditore.costoStampaFacciata;

                const fogliExtra = totaleBuste * costiImprenditore.fogliExtraPerBusta;
                const costoCartaFogliExtra = fogliExtra * costiImprenditore.costoCarta;
                const costoStampaFogliExtra = fogliExtra * costiImprenditore.costoStampaFacciata;

                const costoBuste = totaleBuste * costiImprenditore.costoBusta;
                const costoStampaBuste = totaleBuste * costiImprenditore.costoStampaBusta;

                const costoAvvisiRicevimento = totaliMensili.raccomandate * 
                    (costiImprenditore.costoCartaAvvisoRicevimento + costiImprenditore.costoStampaAvvisoRicevimento);

                const costiSoggettiIVA = totaleFee + costoCartaPagine + costoStampaPagine + 
                    costoCartaFogliExtra + costoStampaFogliExtra + costoBuste + costoStampaBuste + 
                    costoAvvisiRicevimento;

                const iva = costiSoggettiIVA * 0.22;

                const tempoOre = (totaleBuste * costiImprenditore.tempoImbustamentoSecondi) / 3600;
                const costoManodopera = tempoOre * costiImprenditore.costoOrarioDipendente;

                const provvigioniClienti = listino.calcolaProvvigioniClienti 
                    ? calcolaProvvigioniClienti(listino) 
                    : 0;

                const totaleCostiVariabili = costoCartaPagine + costoStampaPagine + 
                    costoCartaFogliExtra + costoStampaFogliExtra + costoBuste + costoStampaBuste +
                    costoAvvisiRicevimento + costoManodopera;

                const totaleCosti = totaleFee + totaleCostiVariabili + iva + provvigioniClienti;

                return {
                    fee: totaleFee,
                    costiVariabili: totaleCostiVariabili,
                    iva: iva,
                    provvigioniClienti,
                    totaleCosti,
                    dettaglio: {
                        feePagine,
                        feeBuste,
                        costoCartaPagine,
                        costoStampaPagine,
                        costoCartaFogliExtra,
                        costoStampaFogliExtra,
                        costoBuste,
                        costoStampaBuste,
                        costoAvvisiRicevimento,
                        costoManodopera
                    }
                };
            };

            const totaleBuste = totaliMensili.prioritarie + totaliMensili.raccomandate;
            const percPrioritarie = totaleBuste > 0 ? (totaliMensili.prioritarie / totaleBuste * 100) : 0;
            const percRaccomandate = totaleBuste > 0 ? (totaliMensili.raccomandate / totaleBuste * 100) : 0;
            const mediaPagineBusta = totaleBuste > 0 ? (totaliMensili.pagine / totaleBuste) : 0;

            return (
                <div className="p-6 max-w-7xl mx-auto bg-gray-50 min-h-screen">
                    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <div className="flex items-center gap-3 mb-4">
                            <Calculator />
                            <h1 className="text-2xl font-bold text-gray-800">
                                Calcolatore Comparativo: Agente vs Imprenditore
                            </h1>
                        </div>
                        <p className="text-gray-600">Confronta la marginalitÃ  tra modalitÃ  Agente e Imprenditore</p>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4">ðŸ“Š Inserisci Totali Mensili</h2>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label className="block font-semibold mb-2">Totale Prioritarie</label>
                                <input
                                    type="number"
                                    min="0"
                                    className="w-full p-2 border rounded"
                                    onChange={(e) => handleInputChange('prioritarie', e.target.value)}
                                />
                            </div>
                            <div>
                                <label className="block font-semibold mb-2">Totale Raccomandate</label>
                                <input
                                    type="number"
                                    min="0"
                                    className="w-full p-2 border rounded"
                                    onChange={(e) => handleInputChange('raccomandate', e.target.value)}
                                />
                            </div>
                            <div>
                                <label className="block font-semibold mb-2">Totale Pagine</label>
                                <input
                                    type="number"
                                    min="0"
                                    className="w-full p-2 border rounded"
                                    onChange={(e) => handleInputChange('pagine', e.target.value)}
                                />
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4">ðŸ’¼ Costi ModalitÃ  Imprenditore</h2>
                        <p className="text-sm text-gray-600 mb-4">Configura i costi e i preset delle provvigioni clienti</p>
                        
                        <div className="mb-4">
                            <h3 className="font-semibold mb-2">Preset Provvigioni Clienti</h3>
                            <div className="grid grid-cols-3 gap-4 mb-4">
                                <div className="border p-3 rounded">
                                    <div className="font-bold mb-2">Listino 203</div>
                                    <div className="text-xs">
                                        <div>Pagine: â‚¬{presetProvvigioni.preset203.pagine.toFixed(3)}</div>
                                        <div>Prioritarie: â‚¬{presetProvvigioni.preset203.prioritarie.toFixed(3)}</div>
                                        <div>Raccomandate: â‚¬{presetProvvigioni.preset203.raccomandate.toFixed(3)}</div>
                                    </div>
                                </div>
                                <div className="border p-3 rounded">
                                    <div className="font-bold mb-2">Listino 204</div>
                                    <div className="text-xs">
                                        <div>Pagine: â‚¬{presetProvvigioni.preset204.pagine.toFixed(3)}</div>
                                        <div>Prioritarie: â‚¬{presetProvvigioni.preset204.prioritarie.toFixed(3)}</div>
                                        <div>Raccomandate: â‚¬{presetProvvigioni.preset204.raccomandate.toFixed(3)}</div>
                                    </div>
                                </div>
                                <div className="border p-3 rounded">
                                    <div className="font-bold mb-2">Listino 205</div>
                                    <div className="text-xs">
                                        <div>Pagine: â‚¬{presetProvvigioni.preset205.pagine.toFixed(3)}</div>
                                        <div>Prioritarie: â‚¬{presetProvvigioni.preset205.prioritarie.toFixed(3)}</div>
                                        <div>Raccomandate: â‚¬{presetProvvigioni.preset205.raccomandate.toFixed(3)}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="text-sm text-gray-600 bg-gray-50 p-3 rounded">
                            <strong>Note:</strong> File HTML standalone pronto per l'uso. Apri direttamente nel browser per utilizzare il calcolatore.
                            Tutti i calcoli sono in tempo reale e funzionano offline.
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CalcolatoreComparativo />);
    </script>
</body>
</html>